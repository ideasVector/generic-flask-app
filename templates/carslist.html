<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
    <title>Cars List</title>

    <link rel="stylesheet" crossorigin="anonymous"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" >

	<script crossorigin="anonymous"
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" >
	</script>

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script
      src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"
      integrity="sha256-xLD7nhI62fcsEZK2/v8LsBcb4lG7dgULkuXoXB/j91c="
      crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="https://releases.jquery.com/git/ui/jquery-ui-git.css">
</head>

<body>
    <h2>Cars List</h2>
    <a class="btn btn-primary" href="addcar">Add New Car</a>
    <table class="table">
        <thead>
            <tr>
            <th scope="col">Id</th>
            <th scope="col">Name</th>
            <th scope="col">Year</th>
            <th scope="col">Price</th>
            <th scope="col">Edit</th>
            <th scope="col">Sell</th>
            <th scope="col">Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for car in cars %}
                <tr>
                    <td>{{ car.id }}</th>
                    <td>{{ car.name }}</td>
                    <td>{{ car.year }}</td>
                    <td>{{ car.price }}</td>
                    <td><a href='updatecar/{{ car.id }}'>Edit</a></td>
                    <td><a href='#' onclick="sellCar({{car.id}}, '{{ car.name }}')">Sell</a></td>
                    <td><a class="deleteButtons" style="cursor:pointer" onclick="deleteCar({{car.id}})">Delete</a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <div id="deleteDialog" title="Delete">Are you sure you wish to delete this car?</div>

        <div id="salesDialog" title="Sale" class="container">
            <form id="sales" name="sales">
                <input type="hidden" id="salescar_id" name="salescar_id">
                <div class="row">
                    <div class="col-sm-12">
                        <label for="salesperson_id">Sales Person</label>
                        <select name="salesperson_id" id="salesperson_id">
                            <option value="">--- Please select ---</option>
                            {% for person in sales_people %}
                            <option value="{{ person.id }}">{{ person.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label for="actual_price">Sales Price</label>
                        <input id="actual_price" name="actual_price" type="number"/>
                    </div>
                </div>
            </form>
        </div>

</body>

<script type="text/javascript">
    $("#deleteDialog").dialog({
        autoOpen: false,
        buttons: {
             "Cancel": function() {
                 $(this).dialog('close');
             },
             "OK": function() {
                 window.location = '/deletecar/'+deleteCarId;
             }
         }
    });
    var deleteCarId = 0;
    function deleteCar(id) {
        deleteCarId = id;
        $("#deleteDialog").dialog("open");
    };

    $("#salesDialog").dialog({
        autoOpen: false,
        buttons: {
             "Cancel": function() {
                 $(this).dialog('close');
             },
             "OK": function() {
                var jxhr = $.ajax( {url: "addsale", data: $( "#sales" ).serialize(), dataType:'json', type:'post'} )
                    .done(function( data ) {
                        alert( "Total sales for that person now stand at " + data['total'] );
                    })
                    .fail(function(xhr, status, error) {
                        alert(xhr);
                    });
             }
         }
    });
    var sellCarId = 0;
    function sellCar(id, carname) {
        sellCarId = id;
        $("#salescar_id").val(sellCarId);
        $("#salesDialog").dialog({show: 'fade', title: carname, modal:true}).dialog("open");
    };

</script>